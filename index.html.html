<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>TPV Bar Professional - Multi-Usuario</title>
    <style>
        /* Reset y base */
        * { margin: 0; padding: 0; box-sizing: border-box; }
        body { font-family: system-ui, -apple-system, sans-serif; line-height: 1.5; color: #374151; }
        
        /* Utilidades de layout */
        .container { max-width: 1200px; margin: 0 auto; }
        .grid { display: grid; }
        .flex { display: flex; }
        .hidden { display: none !important; }
        .block { display: block; }
        .inline { display: inline; }
        .inline-block { display: inline-block; }
        
        /* Grid y flexbox */
        .grid-cols-1 { grid-template-columns: repeat(1, minmax(0, 1fr)); }
        .grid-cols-2 { grid-template-columns: repeat(2, minmax(0, 1fr)); }
        .grid-cols-3 { grid-template-columns: repeat(3, minmax(0, 1fr)); }
        .grid-cols-4 { grid-template-columns: repeat(4, minmax(0, 1fr)); }
        .gap-2 { gap: 0.5rem; }
        .gap-3 { gap: 0.75rem; }
        .gap-4 { gap: 1rem; }
        .gap-6 { gap: 1.5rem; }
        .flex-1 { flex: 1 1 0%; }
        .flex-wrap { flex-wrap: wrap; }
        .items-center { align-items: center; }
        .justify-between { justify-content: space-between; }
        .justify-center { justify-content: center; }
        .text-center { text-align: center; }
        .text-left { text-align: left; }
        
        /* Espaciado */
        .p-2 { padding: 0.5rem; }
        .p-3 { padding: 0.75rem; }
        .p-4 { padding: 1rem; }
        .p-6 { padding: 1.5rem; }
        .p-8 { padding: 2rem; }
        .px-2 { padding-left: 0.5rem; padding-right: 0.5rem; }
        .px-3 { padding-left: 0.75rem; padding-right: 0.75rem; }
        .px-4 { padding-left: 1rem; padding-right: 1rem; }
        .px-6 { padding-left: 1.5rem; padding-right: 1.5rem; }
        .py-1 { padding-top: 0.25rem; padding-bottom: 0.25rem; }
        .py-2 { padding-top: 0.5rem; padding-bottom: 0.5rem; }
        .py-3 { padding-top: 0.75rem; padding-bottom: 0.75rem; }
        .py-6 { padding-top: 1.5rem; padding-bottom: 1.5rem; }
        .py-8 { padding-top: 2rem; padding-bottom: 2rem; }
        .pt-4 { padding-top: 1rem; }
        .mb-2 { margin-bottom: 0.5rem; }
        .mb-3 { margin-bottom: 0.75rem; }
        .mb-4 { margin-bottom: 1rem; }
        .mb-6 { margin-bottom: 1.5rem; }
        .mt-8 { margin-top: 2rem; }
        .mt-12 { margin-top: 3rem; }
        
        /* Colores de fondo */
        .bg-gray-50 { background-color: #f9fafb; }
        .bg-gray-100 { background-color: #f3f4f6; }
        .bg-gray-300 { background-color: #d1d5db; }
        .bg-gray-500 { background-color: #6b7280; }
        .bg-gray-800 { background-color: #1f2937; }
        .bg-white { background-color: #ffffff; }
        .bg-blue-100 { background-color: #dbeafe; }
        .bg-blue-600 { background-color: #2563eb; }
        .bg-blue-700 { background-color: #1d4ed8; }
        .bg-green-100 { background-color: #dcfce7; }
        .bg-green-600 { background-color: #16a34a; }
        .bg-green-700 { background-color: #15803d; }
        .bg-red-50 { background-color: #fef2f2; }
        .bg-red-100 { background-color: #fee2e2; }
        .bg-red-600 { background-color: #dc2626; }
        .bg-red-700 { background-color: #b91c1c; }
        .bg-orange-50 { background-color: #fff7ed; }
        .bg-orange-600 { background-color: #ea580c; }
        .bg-orange-700 { background-color: #c2410c; }
        .bg-yellow-50 { background-color: #fefce8; }
        .bg-yellow-600 { background-color: #ca8a04; }
        .bg-yellow-700 { background-color: #a16207; }
        .bg-purple-50 { background-color: #faf5ff; }
        .bg-purple-600 { background-color: #9333ea; }
        
        /* Colores de texto */
        .text-white { color: #ffffff; }
        .text-gray-300 { color: #d1d5db; }
        .text-gray-500 { color: #6b7280; }
        .text-gray-600 { color: #4b5563; }
        .text-gray-700 { color: #374151; }
        .text-gray-800 { color: #1f2937; }
        .text-blue-600 { color: #2563eb; }
        .text-blue-800 { color: #1e40af; }
        .text-green-600 { color: #16a34a; }
        .text-red-600 { color: #dc2626; }
        .text-red-700 { color: #b91c1c; }
        .text-yellow-700 { color: #a16207; }
        .text-yellow-800 { color: #92400e; }
        .text-purple-600 { color: #9333ea; }
        
        /* Tama√±os de texto */
        .text-xs { font-size: 0.75rem; }
        .text-sm { font-size: 0.875rem; }
        .text-lg { font-size: 1.125rem; }
        .text-xl { font-size: 1.25rem; }
        .text-2xl { font-size: 1.5rem; }
        .text-3xl { font-size: 1.875rem; }
        .text-4xl { font-size: 2.25rem; }
        .text-6xl { font-size: 3.75rem; }
        
        /* Peso de fuente */
        .font-medium { font-weight: 500; }
        .font-semibold { font-weight: 600; }
        .font-bold { font-weight: 700; }
        
        /* Bordes */
        .border { border-width: 1px; border-color: #d1d5db; }
        .border-collapse { border-collapse: collapse; }
        .border-l-4 { border-left-width: 4px; }
        .border-yellow-400 { border-color: #facc15; }
        .border-t { border-top-width: 1px; border-color: #d1d5db; }
        .rounded { border-radius: 0.25rem; }
        .rounded-lg { border-radius: 0.5rem; }
        .rounded-xl { border-radius: 0.75rem; }
        .rounded-2xl { border-radius: 1rem; }
        .rounded-full { border-radius: 9999px; }
        
        /* Sombras */
        .shadow-xl { box-shadow: 0 20px 25px -5px rgba(0, 0, 0, 0.1), 0 10px 10px -5px rgba(0, 0, 0, 0.04); }
        .shadow-2xl { box-shadow: 0 25px 50px -12px rgba(0, 0, 0, 0.25); }
        
        /* Dimensiones */
        .w-8 { width: 2rem; }
        .w-full { width: 100%; }
        .h-8 { height: 2rem; }
        .min-h-screen { min-height: 100vh; }
        .max-h-64 { max-height: 16rem; }
        .max-h-96 { max-height: 24rem; }
        
        /* Overflow */
        .overflow-x-auto { overflow-x: auto; }
        .overflow-y-auto { overflow-y: auto; }
        
        /* Efectos hover */
        .hover\:bg-blue-700:hover { background-color: #1d4ed8; }
        .hover\:bg-green-700:hover { background-color: #15803d; }
        .hover\:bg-orange-700:hover { background-color: #c2410c; }
        .hover\:bg-yellow-700:hover { background-color: #a16207; }
        .hover\:bg-red-700:hover { background-color: #b91c1c; }
        .hover\:shadow-lg:hover { box-shadow: 0 10px 15px -3px rgba(0, 0, 0, 0.1), 0 4px 6px -2px rgba(0, 0, 0, 0.05); }
        
        /* Transiciones */
        .transition-all { transition: all 0.15s ease-in-out; }
        .transition-shadow { transition: box-shadow 0.15s ease-in-out; }
        
        /* Opacidad */
        .opacity-50 { opacity: 0.5; }
        
        /* Espaciado */
        .space-y-3 > * + * { margin-top: 0.75rem; }
        .space-y-6 > * + * { margin-top: 1.5rem; }
        
        /* Custom styles */
        .gradient-bg { background: linear-gradient(135deg, #667eea 0%, #764ba2 100%); }
        .tab-content { display: none; }
        .tab-content.active { display: block; }
        
        /* Status indicators */
        .status-online { 
            width: 10px; 
            height: 10px; 
            background: #10b981; 
            border-radius: 50%; 
            display: inline-block; 
            margin-right: 8px;
            animation: pulse 2s infinite;
        }
        
        .status-offline { 
            width: 10px; 
            height: 10px; 
            background: #ef4444; 
            border-radius: 50%; 
            display: inline-block; 
            margin-right: 8px;
        }
        
        @keyframes pulse {
            0%, 100% { opacity: 1; }
            50% { opacity: 0.5; }
        }
        
        /* Loading spinner */
        .spinner {
            border: 2px solid #f3f3f3;
            border-top: 2px solid #3498db;
            border-radius: 50%;
            width: 20px;
            height: 20px;
            animation: spin 1s linear infinite;
            display: inline-block;
            margin-right: 8px;
        }
        
        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }
        
        /* Responsive */
        @media (min-width: 768px) {
            .md\:grid-cols-2 { grid-template-columns: repeat(2, minmax(0, 1fr)); }
            .md\:grid-cols-3 { grid-template-columns: repeat(3, minmax(0, 1fr)); }
            .md\:grid-cols-4 { grid-template-columns: repeat(4, minmax(0, 1fr)); }
        }
        
        @media (min-width: 1024px) {
            .lg\:grid-cols-3 { grid-template-columns: repeat(3, minmax(0, 1fr)); }
            .lg\:col-span-2 { grid-column: span 2 / span 2; }
        }
        
        /* Botones disabled */
        button:disabled {
            opacity: 0.5;
            cursor: not-allowed;
        }
        
        button:disabled:hover {
            background-color: inherit !important;
        }
        
        /* Inputs */
        input, select {
            border: 1px solid #d1d5db;
            outline: none;
        }
        
        input:focus, select:focus {
            border-color: #2563eb;
            box-shadow: 0 0 0 3px rgba(37, 99, 235, 0.1);
        }
        
        /* Tablas */
        table {
            border-collapse: collapse;
        }
        
        td, th {
            border: 1px solid #d1d5db;
        }
        
        /* File upload styling */
        .file-upload {
            position: relative;
            display: inline-block;
            width: 100%;
        }
        
        .file-upload input[type=file] {
            position: absolute;
            opacity: 0;
            width: 100%;
            height: 100%;
            cursor: pointer;
        }
        
        .file-upload-label {
            display: block;
            padding: 12px;
            background: #f3f4f6;
            border: 2px dashed #d1d5db;
            border-radius: 8px;
            text-align: center;
            cursor: pointer;
            transition: all 0.3s ease;
        }
        
        .file-upload-label:hover {
            background: #e5e7eb;
            border-color: #2563eb;
        }
        
        .notification {
            position: fixed;
            top: 20px;
            right: 20px;
            padding: 16px;
            border-radius: 8px;
            color: white;
            font-weight: 500;
            z-index: 1000;
            animation: slideIn 0.3s ease;
        }
        
        .notification.success { background: #10b981; }
        .notification.error { background: #ef4444; }
        .notification.info { background: #3b82f6; }
        
        @keyframes slideIn {
            from { transform: translateX(100%); opacity: 0; }
            to { transform: translateX(0); opacity: 1; }
        }
    </style>
</head>
<body>
    <div class="min-h-screen bg-gray-100">
        <!-- Header -->
        <div class="gradient-bg text-white shadow-2xl">
            <div class="container mx-auto px-6 py-8">
                <h1 class="text-4xl font-bold text-center mb-2">üç∫ TPV Bar Professional</h1>
                <div class="text-center mb-6">
                    <span id="connection-status" class="text-sm">
                        <span class="status-offline"></span>Conectando...
                    </span>
                    <span id="users-online" class="text-xs ml-4">üë• 0 usuarios online</span>
                </div>
                <div class="flex gap-4 justify-center flex-wrap">
                    <button onclick="mostrarTab('tpv')" id="btn-tpv" class="tab-btn px-6 py-3 rounded-xl font-bold transition-all bg-white text-gray-800">
                        üõí TPV
                    </button>
                    <button onclick="mostrarTab('almacen')" id="btn-almacen" class="tab-btn px-6 py-3 rounded-xl font-bold transition-all bg-blue-600 text-white hover:bg-blue-700">
                        üì¶ Almac√©n
                    </button>
                    <button onclick="mostrarTab('import')" id="btn-import" class="tab-btn px-6 py-3 rounded-xl font-bold transition-all bg-purple-600 text-white hover:bg-blue-700">
                        üìä Importar Excel
                    </button>
                    <button onclick="mostrarTab('stats')" id="btn-stats" class="tab-btn px-6 py-3 rounded-xl font-bold transition-all bg-blue-600 text-white hover:bg-blue-700">
                        üìà Estad√≠sticas
                    </button>
                    <button onclick="mostrarTab('config')" id="btn-config" class="tab-btn px-6 py-3 rounded-xl font-bold transition-all bg-blue-600 text-white hover:bg-blue-700">
                        ‚öôÔ∏è Configuraci√≥n
                    </button>
                </div>
            </div>
        </div>

        <div class="container mx-auto p-6">
            <!-- TPV -->
            <div id="tab-tpv" class="tab-content active">
                <div class="grid lg:grid-cols-3 gap-6">
                    <div class="lg:col-span-2 bg-white rounded-2xl shadow-xl p-6">
                        <h2 class="text-2xl font-bold mb-4">üõçÔ∏è Productos</h2>
                        
                        <div class="grid md:grid-cols-2 gap-4 mb-4">
                            <select id="filtro-categoria" onchange="filtrarProductos()" class="px-3 py-2 border rounded-lg">
                                <option value="Todas">Todas las categor√≠as</option>
                                <option value="Bebidas">üç∫ Bebidas</option>
                                <option value="Comida">üçï Comida</option>
                                <option value="Otros">üì¶ Otros</option>
                            </select>
                            <input id="busqueda" oninput="filtrarProductos()" placeholder="üîç Buscar producto..." class="px-3 py-2 border rounded-lg">
                        </div>

                        <div id="productos-grid" class="grid md:grid-cols-2 gap-3 max-h-96 overflow-y-auto">
                            <div class="text-center py-8 text-gray-500">
                                <div class="spinner"></div>
                                Cargando productos...
                            </div>
                        </div>
                    </div>

                    <div class="bg-white rounded-2xl shadow-xl p-6">
                        <h2 class="text-2xl font-bold mb-4">üõí Carrito</h2>
                        <div id="carrito-contenido">
                            <div class="text-center py-8">
                                <div class="text-6xl mb-4">üõí</div>
                                <p class="text-gray-500">Carrito vac√≠o</p>
                            </div>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Importar Excel -->
            <div id="tab-import" class="tab-content">
                <div class="bg-white rounded-2xl shadow-xl p-6">
                    <h2 class="text-2xl font-bold mb-6">üìä Importar Productos desde Excel</h2>
                    
                    <div class="grid md:grid-cols-2 gap-6">
                        <div>
                            <h3 class="text-lg font-bold mb-4">üìÅ Subir archivo Excel</h3>
                            <div class="file-upload mb-4">
                                <input type="file" id="excel-file" accept=".xlsx,.xls" onchange="procesarExcel(this)">
                                <label for="excel-file" class="file-upload-label">
                                    <div class="text-4xl mb-2">üìä</div>
                                    <div class="font-medium">Haz clic o arrastra tu archivo Excel aqu√≠</div>
                                    <div class="text-sm text-gray-500 mt-2">Formatos: .xlsx, .xls</div>
                                </label>
                            </div>
                            
                            <div id="import-progress" class="hidden">
                                <div class="bg-blue-50 p-4 rounded-lg">
                                    <div class="flex items-center mb-2">
                                        <div class="spinner"></div>
                                        <span class="font-medium">Procesando archivo...</span>
                                    </div>
                                    <div class="text-sm text-gray-600" id="import-status">Analizando datos...</div>
                                </div>
                            </div>
                        </div>
                        
                        <div>
                            <h3 class="text-lg font-bold mb-4">‚ÑπÔ∏è Formato del Excel</h3>
                            <div class="bg-gray-50 p-4 rounded-lg">
                                <h4 class="font-medium mb-2">Columnas requeridas:</h4>
                                <ul class="text-sm space-y-1">
                                    <li>‚Ä¢ <strong>Descripci√≥n Art.</strong> - Nombre del producto</li>
                                    <li>‚Ä¢ <strong>Precio/Pieza/Kg</strong> - Precio unitario</li>
                                    <li>‚Ä¢ <strong>Cantidad</strong> - Stock (opcional)</li>
                                    <li>‚Ä¢ <strong>GTIN</strong> - C√≥digo de barras (opcional)</li>
                                </ul>
                            </div>
                            
                            <div class="mt-4 p-4 bg-yellow-50 border-l-4 border-yellow-400 rounded">
                                <h4 class="font-medium text-yellow-800">üîÑ L√≥gica de importaci√≥n:</h4>
                                <ul class="text-sm text-yellow-700 mt-2 space-y-1">
                                    <li>‚Ä¢ Si el producto existe ‚Üí suma stock</li>
                                    <li>‚Ä¢ Si es nuevo ‚Üí crea producto</li>
                                    <li>‚Ä¢ Actualiza precios autom√°ticamente</li>
                                    <li>‚Ä¢ Detecta categor√≠as por nombre</li>
                                </ul>
                            </div>
                        </div>
                    </div>
                    
                    <div id="import-results" class="mt-6 hidden">
                        <h3 class="text-lg font-bold mb-4">üìã Resultados de la importaci√≥n</h3>
                        <div id="import-summary" class="grid md:grid-cols-3 gap-4"></div>
                        <div id="import-details" class="mt-4"></div>
                    </div>
                </div>
            </div>

            <!-- Almac√©n -->
            <div id="tab-almacen" class="tab-content">
                <div class="bg-white rounded-2xl shadow-xl p-6">
                    <div class="flex justify-between items-center mb-6">
                        <h2 class="text-2xl font-bold">üì¶ Inventario</h2>
                        <div class="flex gap-3">
                            <button onclick="mostrarAjuste()" class="bg-orange-600 text-white px-4 py-2 rounded-lg hover:bg-orange-700">
                                ‚ö†Ô∏è Ajustar Stock
                            </button>
                            <button onclick="mostrarFormulario()" class="bg-green-600 text-white px-4 py-2 rounded-lg hover:bg-green-700">
                                ‚ûï Nuevo
                            </button>
                            <button onclick="sincronizarDatos()" class="bg-blue-600 text-white px-4 py-2 rounded-lg hover:bg-blue-700">
                                üîÑ Sincronizar
                            </button>
                        </div>
                    </div>

                    <div id="formulario-ajuste" class="bg-orange-50 p-4 rounded-lg mb-6 hidden">
                        <h3 class="font-bold mb-3">‚ö†Ô∏è Ajustar Stock</h3>
                        <div class="grid grid-cols-1 md:grid-cols-4 gap-3 mb-3">
                            <select id="ajuste-producto" class="px-3 py-2 border rounded-lg">
                                <option value="">Seleccionar producto</option>
                            </select>
                            <select id="ajuste-tipo" class="px-3 py-2 border rounded-lg">
                                <option value="perdida">üìâ P√©rdida</option>
                                <option value="entrada">üìà Entrada</option>
                            </select>
                            <input id="ajuste-cantidad" type="number" placeholder="Cantidad" class="px-3 py-2 border rounded-lg">
                            <input id="ajuste-motivo" placeholder="Motivo" class="px-3 py-2 border rounded-lg">
                        </div>
                        <div class="flex gap-2">
                            <button onclick="procesarAjuste()" class="bg-orange-600 text-white px-4 py-2 rounded-lg">üíæ Procesar</button>
                            <button onclick="ocultarAjuste()" class="bg-gray-500 text-white px-4 py-2 rounded-lg">‚ùå Cancelar</button>
                        </div>
                    </div>

                    <div id="formulario-nuevo" class="bg-gray-50 p-4 rounded-lg mb-6 hidden">
                        <h3 class="font-bold mb-3">‚ûï Nuevo Producto</h3>
                        <div class="grid grid-cols-1 md:grid-cols-4 gap-3 mb-3">
                            <input id="nuevo-nombre" placeholder="Nombre del producto" class="px-3 py-2 border rounded-lg">
                            <input id="nuevo-precio" type="number" step="0.01" placeholder="Precio ‚Ç¨" class="px-3 py-2 border rounded-lg">
                            <input id="nuevo-stock" type="number" placeholder="Stock inicial" class="px-3 py-2 border rounded-lg">
                            <select id="nuevo-categoria" class="px-3 py-2 border rounded-lg">
                                <option value="Bebidas">üç∫ Bebidas</option>
                                <option value="Comida">üçï Comida</option>
                                <option value="Otros">üì¶ Otros</option>
                            </select>
                        </div>
                        <div class="flex gap-2">
                            <button onclick="agregarProducto()" class="bg-green-600 text-white px-4 py-2 rounded-lg">üíæ Guardar</button>
                            <button onclick="ocultarFormulario()" class="bg-gray-500 text-white px-4 py-2 rounded-lg">‚ùå Cancelar</button>
                        </div>
                    </div>

                    <div id="alerta-stock" class="bg-yellow-50 border-l-4 border-yellow-400 p-4 mb-6 hidden">
                        <h4 class="text-yellow-800 font-bold">‚ö†Ô∏è Stock Bajo:</h4>
                        <p id="productos-stock-bajo" class="text-yellow-700"></p>
                    </div>

                    <div class="overflow-x-auto">
                        <table class="w-full border-collapse border">
                            <thead class="bg-gray-100">
                                <tr>
                                    <th class="border px-4 py-2 text-left">Producto</th>
                                    <th class="border px-4 py-2 text-left">Precio</th>
                                    <th class="border px-4 py-2 text-left">Stock</th>
                                    <th class="border px-4 py-2 text-left">Categor√≠a</th>
                                    <th class="border px-4 py-2 text-left">Acciones</th>
                                </tr>
                            </thead>
                            <tbody id="tabla-productos">
                                <tr>
                                    <td colspan="5" class="border px-4 py-2 text-center text-gray-500">
                                        <div class="spinner"></div>
                                        Cargando productos...
                                    </td>
                                </tr>
                            </tbody>
                        </table>
                    </div>
                </div>
            </div>

            <!-- Estad√≠sticas -->
            <div id="tab-stats" class="tab-content">
                <div class="space-y-6">
                    <div class="grid md:grid-cols-4 gap-6">
                        <div class="bg-white rounded-2xl shadow-xl p-6 text-center">
                            <div class="text-4xl mb-2">üí∞</div>
                            <h3 class="font-bold text-gray-700">Total Ventas</h3>
                            <p id="total-ventas" class="text-3xl font-bold text-green-600">‚Ç¨0.00</p>
                            <p id="num-ventas" class="text-sm text-gray-500">0 transacciones</p>
                        </div>
                        
                        <div class="bg-white rounded-2xl shadow-xl p-6 text-center">
                            <div class="text-4xl mb-2">üì¶</div>
                            <h3 class="font-bold text-gray-700">Productos</h3>
                            <p id="num-productos" class="text-3xl font-bold text-blue-600">0</p>
                            <p id="productos-bajo-stock" class="text-sm text-gray-500">0 stock bajo</p>
                        </div>
                        
                        <div class="bg-white rounded-2xl shadow-xl p-6 text-center">
                            <div class="text-4xl mb-2">üîÑ</div>
                            <h3 class="font-bold text-gray-700">Ajustes</h3>
                            <p id="num-ajustes" class="text-3xl font-bold text-purple-600">0</p>
                            <p class="text-sm text-gray-500">movimientos</p>
                        </div>
                        
                        <div class="bg-white rounded-2xl shadow-xl p-6 text-center">
                            <div class="text-4xl mb-2">üë•</div>
                            <h3 class="font-bold text-gray-700">Usuarios</h3>
                            <p id="usuarios-activos" class="text-3xl font-bold text-purple-600">0</p>
                            <p class="text-sm text-gray-500">conectados</p>
                        </div>
                    </div>

                    <div class="bg-white rounded-2xl shadow-xl p-6">
                        <h3 class="text-xl font-bold mb-4">üìà √öltimas Ventas</h3>
                        <div id="tabla-ventas-container">
                            <p class="text-center text-gray-500 py-8">No hay ventas registradas</p>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Configuraci√≥n -->
            <div id="tab-config" class="tab-content">
                <div class="bg-white rounded-2xl shadow-xl p-6">
                    <h2 class="text-2xl font-bold mb-6">‚öôÔ∏è Configuraci√≥n</h2>
                    
                    <div class="grid md:grid-cols-2 gap-6">
                        <div>
                            <h3 class="text-lg font-bold mb-4">‚òÅÔ∏è Base de Datos</h3>
                            <div class="space-y-3">
                                <button onclick="inicializarBaseDatos()" class="w-full bg-blue-600 text-white py-3 px-4 rounded-lg hover:bg-blue-700">
                                    üîÑ Inicializar Firebase
                                </button>
                                <button onclick="exportarDatos()" class="w-full bg-green-600 text-white py-2 px-4 rounded-lg hover:bg-green-700">
                                    üì§ Exportar Backup
                                </button>
                                <div class="file-upload">
                                    <input type="file" id="import-backup" accept=".json" onchange="importarBackup(this)">
                                    <label for="import-backup" class="file-upload-label">
                                        üì• Importar Backup
                                    </label>
                                </div>
                            </div>
                        </div>
                        
                        <div>
                            <h3 class="text-lg font-bold mb-4 text-red-700">‚ö†Ô∏è Acciones Peligrosas</h3>
                            <div class="space-y-3">
                                <button onclick="borrarVentas()" class="w-full bg-yellow-600 text-white py-2 px-4 rounded-lg hover:bg-yellow-700">
                                    üóëÔ∏è Borrar Solo Ventas
                                </button>
                                <button onclick="resetCompleto()" class="w-full bg-red-600 text-white py-2 px-4 rounded-lg hover:bg-red-700">
                                    üí• RESET COMPLETO
                                </button>
                            </div>
                        </div>
                    </div>

                    <div class="mt-8">
                        <h3 class="text-xl font-bold mb-4">üìã Historial de Ajustes</h3>
                        <div class="overflow-x-auto">
                            <table class="w-full border-collapse border">
                                <thead class="bg-gray-100">
                                    <tr>
                                        <th class="border px-4 py-2 text-left">Fecha</th>
                                        <th class="border px-4 py-2 text-left">Usuario</th>
                                        <th class="border px-4 py-2 text-left">Producto</th>
                                        <th class="border px-4 py-2 text-left">Tipo</th>
                                        <th class="border px-4 py-2 text-left">Cantidad</th>
                                        <th class="border px-4 py-2 text-left">Motivo</th>
                                    </tr>
                                </thead>
                                <tbody id="tabla-ajustes">
                                    <tr>
                                        <td colspan="6" class="border px-4 py-2 text-center text-gray-500">No hay ajustes registrados</td>
                                    </tr>
                                </tbody>
                            </table>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <footer class="bg-gray-800 text-white py-6 mt-12">
            <div class="container mx-auto px-6 text-center">
                <p class="text-lg font-semibold">üç∫ TPV Bar Professional - Multi-Usuario</p>
                <p class="text-gray-300">Sistema en tiempo real con base de datos compartida</p>
            </div>
        </footer>
    </div>

    <!-- Firebase SDK -->
    <script type="module">
        // Import Firebase modules
        import { initializeApp } from 'https://www.gstatic.com/firebasejs/9.22.0/firebase-app.js';
        import { getDatabase, ref, push, set, get, onValue, off, remove, update } from 'https://www.gstatic.com/firebasejs/9.22.0/firebase-database.js';

        // Firebase configuration (REEMPLAZAR CON TU CONFIGURACI√ìN)
        const firebaseConfig = {
            // ‚ö†Ô∏è INSTRUCCIONES: 
            // 1. Ve a https://console.firebase.google.com/
            // 2. Crea un nuevo proyecto
            // 3. Activa Realtime Database
            // 4. Copia tu configuraci√≥n aqu√≠:
            apiKey: "TU_API_KEY",
            authDomain: "tu-proyecto.firebaseapp.com",
            databaseURL: "https://tu-proyecto-default-rtdb.firebaseio.com/",
            projectId: "tu-proyecto",
            storageBucket: "tu-proyecto.appspot.com",
            messagingSenderId: "123456789",
            appId: "tu-app-id"
        };

        // Variables globales
        let app, database;
        let productos = [];
        let carrito = [];
        let ventas = [];
        let ajustes = [];
        let editandoId = null;
        let usuarioId = generateUserId();
        let isConnected = false;

        // Generar ID √∫nico para usuario
        function generateUserId() {
            return 'user_' + Math.random().toString(36).substr(2, 9) + '_' + Date.now();
        }

        // Mostrar notificaci√≥n
        function mostrarNotificacion(mensaje, tipo = 'info') {
            const notification = document.createElement('div');
            notification.className = `notification ${tipo}`;
            notification.textContent = mensaje;
            document.body.appendChild(notification);
            
            setTimeout(() => {
                notification.remove();
            }, 3000);
        }

        // Inicializar Firebase
        window.inicializarBaseDatos = function() {
            try {
                app = initializeApp(firebaseConfig);
                database = getDatabase(app);
                
                // Marcar usuario como online
                const userRef = ref(database, `usuarios/${usuarioId}`);
                set(userRef, {
                    conectado: true,
                    ultimaActividad: Date.now()
                });
                
                // Escuchar cuando se desconecta
                window.addEventListener('beforeunload', () => {
                    set(userRef, {
                        conectado: false,
                        ultimaActividad: Date.now()
                    });
                });
                
                // Cargar datos iniciales
                cargarDatosIniciales();
                configurarListeners();
                actualizarEstadoConexion(true);
                mostrarNotificacion('‚úÖ Conectado a Firebase', 'success');
                
            } catch (error) {
                console.error('Error inicializando Firebase:', error);
                mostrarNotificacion('‚ùå Error conectando a Firebase - usando modo offline', 'info');
                // Modo offline - usar datos en memoria
                cargarDatosLocales();
                actualizarEstadoConexion(false);
            }
        };

        // Cargar datos desde Firebase
        function cargarDatosIniciales() {
            const productosRef = ref(database, 'productos');
            const ventasRef = ref(database, 'ventas');
            const ajustesRef = ref(database, 'ajustes');
            
            onValue(productosRef, (snapshot) => {
                const data = snapshot.val();
                productos = data ? Object.values(data) : [];
                mostrarProductos();
                mostrarTablaProductos();
                actualizarSelectAjuste();
            });
            
            onValue(ventasRef, (snapshot) => {
                const data = snapshot.val();
                ventas = data ? Object.values(data) : [];
                actualizarEstadisticas();
            });
            
            onValue(ajustesRef, (snapshot) => {
                const data = snapshot.val();
                ajustes = data ? Object.values(data) : [];
                mostrarHistorialAjustes();
            });
        }

        // Configurar listeners en tiempo real
        function configurarListeners() {
            // Usuarios online
            const usuariosRef = ref(database, 'usuarios');
            onValue(usuariosRef, (snapshot) => {
                const usuarios = snapshot.val() || {};
                const online = Object.values(usuarios).filter(u => u.conectado).length;
                document.getElementById('users-online').textContent = `üë• ${online} usuarios online`;
                document.getElementById('usuarios-activos').textContent = online;
            });
        }

        // Cargar datos locales (modo offline)
        function cargarDatosLocales() {
            const datosLocales = localStorage.getItem('tpv-datos');
            if (datosLocales) {
                const datos = JSON.parse(datosLocales);
                productos = datos.productos || [];
                ventas = datos.ventas || [];
                ajustes = datos.ajustes || [];
            } else {
                // Datos de ejemplo
                productos = [
                    { id: 1, nombre: 'Cerveza Amstel Radler 33cl', precio: 0.45, stock: 24, categoria: 'Bebidas' },
                    { id: 2, nombre: 'Vermut Miro Casero 1,5L', precio: 6.30, stock: 12, categoria: 'Bebidas' },
                    { id: 3, nombre: 'Patatas Caseras Gallo Rojo 160gr', precio: 1.55, stock: 20, categoria: 'Comida' },
                    { id: 4, nombre: 'Torreznillos Fritos 200g', precio: 2.85, stock: 15, categoria: 'Comida' },
                    { id: 5, nombre: 'Coca-Cola 33cl', precio: 0.61, stock: 45, categoria: 'Bebidas' }
                ];
            }
            mostrarProductos();
            mostrarTablaProductos();
            actualizarSelectAjuste();
            actualizarEstadisticas();
        }

        // Guardar en Firebase o localStorage
        function guardarDatos() {
            if (database && isConnected) {
                // Guardar en Firebase
                set(ref(database, 'productos'), productos);
                set(ref(database, 'ventas'), ventas);
                set(ref(database, 'ajustes'), ajustes);
            } else {
                // Guardar localmente
                const datos = { productos, ventas, ajustes };
                localStorage.setItem('tpv-datos', JSON.stringify(datos));
            }
        }

        // Actualizar estado de conexi√≥n
        function actualizarEstadoConexion(conectado) {
            isConnected = conectado;
            const statusElement = document.getElementById('connection-status');
            if (conectado) {
                statusElement.innerHTML = '<span class="status-online"></span>Conectado a Firebase';
            } else {
                statusElement.innerHTML = '<span class="status-offline"></span>Modo Offline';
            }
        }

        // Procesar archivo Excel
        window.procesarExcel = async function(input) {
            const file = input.files[0];
            if (!file) return;

            document.getElementById('import-progress').classList.remove('hidden');
            document.getElementById('import-results').classList.add('hidden');

            try {
                // Simular SheetJS (en implementaci√≥n real necesitar√≠as la librer√≠a)
                const reader = new FileReader();
                reader.onload = function(e) {
                    try {
                        // Aqu√≠ ir√≠a el procesamiento real del Excel
                        // Por ahora simulamos datos
                        procesarDatosExcel(simularDatosExcel());
                    } catch (error) {
                        mostrarNotificacion('‚ùå Error procesando Excel: ' + error.message, 'error');
                        document.getElementById('import-progress').classList.add('hidden');
                    }
                };
                reader.readAsArrayBuffer(file);

            } catch (error) {
                mostrarNotificacion('‚ùå Error leyendo archivo', 'error');
                document.getElementById('import-progress').classList.add('hidden');
            }
        };

        // Simular datos de Excel (reemplazar con procesamiento real)
        function simularDatosExcel() {
            return [
                { nombre: 'CZA AMSTEL RADLER LT 33CL', precio: 0.45, cantidad: 24, categoria: 'Bebidas' },
                { nombre: 'PATATA CASERA GALLO ROJO 160GR', precio: 1.55, cantidad: 10, categoria: 'Comida' },
                { nombre: 'VERMUT MIRO CASERO 1,5L', precio: 6.30, cantidad: 5, categoria: 'Bebidas' },
                { nombre: 'COCA-COLA LT 33CL REGULAR', precio: 0.61, cantidad: 30, categoria: 'Bebidas' }
            ];
        }

        // Procesar datos del Excel
        function procesarDatosExcel(datosExcel) {
            let productosNuevos = 0;
            let productosActualizados = 0;
            let stockSumado = 0;

            document.getElementById('import-status').textContent = 'Procesando productos...';

            datosExcel.forEach(item => {
                const productoExistente = productos.find(p => 
                    p.nombre.toLowerCase().includes(item.nombre.toLowerCase()) ||
                    item.nombre.toLowerCase().includes(p.nombre.toLowerCase())
                );

                if (productoExistente) {
                    // Producto existe - sumar stock y actualizar precio
                    productoExistente.stock += item.cantidad || 0;
                    productoExistente.precio = item.precio || productoExistente.precio;
                    productosActualizados++;
                    stockSumado += item.cantidad || 0;
                } else {
                    // Producto nuevo
                    const nuevoProducto = {
                        id: Date.now() + Math.random(),
                        nombre: item.nombre,
                        precio: item.precio || 0,
                        stock: item.cantidad || 0,
                        categoria: item.categoria || determinarCategoria(item.nombre)
                    };
                    productos.push(nuevoProducto);
                    productosNuevos++;
                }
            });

            // Guardar cambios
            guardarDatos();
            
            // Actualizar interfaz
            mostrarProductos();
            mostrarTablaProductos();
            actualizarSelectAjuste();

            // Mostrar resultados
            mostrarResultadosImportacion(productosNuevos, productosActualizados, stockSumado);
            
            document.getElementById('import-progress').classList.add('hidden');
            mostrarNotificacion('‚úÖ Excel importado correctamente', 'success');
        }

        // Determinar categor√≠a por nombre
        function determinarCategoria(nombre) {
            const nombreLower = nombre.toLowerCase();
            if (nombreLower.includes('cza') || nombreLower.includes('cerveza') || 
                nombreLower.includes('vino') || nombreLower.includes('vermut') ||
                nombreLower.includes('coca') || nombreLower.includes('kas') ||
                nombreLower.includes('zumo') || nombreLower.includes('agua')) {
                return 'Bebidas';
            } else if (nombreLower.includes('patata') || nombreLower.includes('torrezn') ||
                       nombreLower.includes('frito') || nombreLower.includes('aceitunas')) {
                return 'Comida';
            }
            return 'Otros';
        }

        // Mostrar resultados de importaci√≥n
        function mostrarResultadosImportacion(nuevos, actualizados, stockSumado) {
            document.getElementById('import-results').classList.remove('hidden');
            
            document.getElementById('import-summary').innerHTML = `
                <div class="bg-green-50 p-4 rounded-lg text-center">
                    <div class="text-2xl font-bold text-green-600">${nuevos}</div>
                    <div class="text-sm text-green-700">Productos nuevos</div>
                </div>
                <div class="bg-blue-50 p-4 rounded-lg text-center">
                    <div class="text-2xl font-bold text-blue-600">${actualizados}</div>
                    <div class="text-sm text-blue-700">Productos actualizados</div>
                </div>
                <div class="bg-purple-50 p-4 rounded-lg text-center">
                    <div class="text-2xl font-bold text-purple-600">${stockSumado}</div>
                    <div class="text-sm text-purple-700">Stock total sumado</div>
                </div>
            `;
        }

        // Resto de funciones del TPV (adaptadas para Firebase)
        window.mostrarTab = function(tab) {
            document.querySelectorAll('.tab-content').forEach(el => el.classList.remove('active'));
            document.querySelectorAll('.tab-btn').forEach(el => {
                el.className = 'tab-btn px-6 py-3 rounded-xl font-bold transition-all bg-blue-600 text-white hover:bg-blue-700';
            });

            document.getElementById('tab-' + tab).classList.add('active');
            document.getElementById('btn-' + tab).className = 'tab-btn px-6 py-3 rounded-xl font-bold transition-all bg-white text-gray-800';

            if (tab === 'tpv') {
                mostrarProductos();
                mostrarCarrito();
            } else if (tab === 'almacen') {
                mostrarTablaProductos();
                actualizarSelectAjuste();
                verificarStockBajo();
            } else if (tab === 'stats') {
                actualizarEstadisticas();
            } else if (tab === 'config') {
                mostrarHistorialAjustes();
            }
        };

        function mostrarProductos() {
            const grid = document.getElementById('productos-grid');
            const filtro = document.getElementById('filtro-categoria').value;
            const busqueda = document.getElementById('busqueda').value.toLowerCase();

            const productosFiltrados = productos.filter(p => {
                const coincideCategoria = filtro === 'Todas' || p.categoria === filtro;
                const coincideBusqueda = p.nombre.toLowerCase().includes(busqueda);
                return coincideCategoria && coincideBusqueda;
            });

            if (productosFiltrados.length === 0) {
                grid.innerHTML = '<div class="text-center py-8 text-gray-500">No hay productos disponibles</div>';
                return;
            }

            grid.innerHTML = productosFiltrados.map(p => `
                <div class="border rounded-xl p-4 hover:shadow-lg transition-shadow ${p.stock <= 0 ? 'opacity-50' : ''}">
                    <div class="flex justify-between mb-2">
                        <h3 class="font-bold text-sm">${p.nombre}</h3>
                        <span class="text-lg font-bold text-green-600">‚Ç¨${p.precio.toFixed(2)}</span>
                    </div>
                    <div class="flex justify-between items-center mb-3">
                        <span class="text-sm font-medium ${p.stock < 10 ? 'text-red-600' : 'text-gray-600'}">üì¶ ${p.stock}</span>
                        <span class="bg-blue-100 text-blue-800 px-2 py-1 rounded-full text-xs">${getCategoriaIcon(p.categoria)} ${p.categoria}</span>
                    </div>
                    <button onclick="agregarAlCarrito(${p.id})" ${p.stock <= 0 ? 'disabled' : ''} 
                        class="w-full py-2 px-4 rounded-lg font-medium text-sm ${p.stock <= 0 ? 'bg-gray-300 text-gray-500' : 'bg-blue-600 text-white hover:bg-blue-700'}">
                        ${p.stock <= 0 ? '‚ùå Sin Stock' : '‚ûï Agregar'}
                    </button>
                </div>
            `).join('');
        }

        function getCategoriaIcon(categoria) {
            switch(categoria) {
                case 'Bebidas': return 'üç∫';
                case 'Comida': return 'üçï';
                case 'Otros': return 'üì¶';
                default: return 'üì¶';
            }
        }

        window.filtrarProductos = function() {
            mostrarProductos();
        };

        window.agregarAlCarrito = function(id) {
            const producto = productos.find(p => p.id === id);
            if (producto.stock <= 0) {
                mostrarNotificacion('‚ùå Sin stock disponible', 'error');
                return;
            }

            const item = carrito.find(i => i.id === id);
            if (item) {
                if (item.cantidad >= producto.stock) {
                    mostrarNotificacion('‚ùå Stock insuficiente', 'error');
                    return;
                }
                item.cantidad++;
            } else {
                carrito.push({ ...producto, cantidad: 1 });
            }
            mostrarCarrito();
        };

        function mostrarCarrito() {
            const contenido = document.getElementById('carrito-contenido');
            
            if (carrito.length === 0) {
                contenido.innerHTML = `
                    <div class="text-center py-8">
                        <div class="text-6xl mb-4">üõí</div>
                        <p class="text-gray-500">Carrito vac√≠o</p>
                    </div>
                `;
                return;
            }

            const total = carrito.reduce((s, i) => s + (i.precio * i.cantidad), 0);

            contenido.innerHTML = `
                <div class="space-y-3 mb-4 max-h-64 overflow-y-auto">
                    ${carrito.map(item => `
                        <div class="flex justify-between items-center bg-gray-50 rounded-lg p-3">
                            <div class="flex-1">
                                <h4 class="font-medium text-sm">${item.nombre}</h4>
                                <p class="text-sm text-gray-600">‚Ç¨${item.precio.toFixed(2)} c/u</p>
                            </div>
                            <div class="flex items-center gap-2">
                                <button onclick="cambiarCantidad(${item.id}, ${item.cantidad - 1})" class="w-8 h-8 bg-red-100 text-red-600 rounded-full text-sm">‚ûñ</button>
                                <span class="w-8 text-center font-bold">${item.cantidad}</span>
                                <button onclick="cambiarCantidad(${item.id}, ${item.cantidad + 1})" class="w-8 h-8 bg-green-100 text-green-600 rounded-full text-sm">‚ûï</button>
                            </div>
                        </div>
                    `).join('')}
                </div>
                <div class="border-t pt-4">
                    <div class="flex justify-between mb-4">
                        <span class="text-xl font-bold">Total:</span>
                        <span class="text-2xl font-bold text-green-600">‚Ç¨${total.toFixed(2)}</span>
                    </div>
                    <button onclick="procesarVenta()" class="w-full bg-green-600 text-white py-3 px-4 rounded-xl font-bold text-lg hover:bg-green-700">
                        üí≥ Procesar Venta
                    </button>
                </div>
            `;
        }

        window.cambiarCantidad = function(id, nuevaCantidad) {
            if (nuevaCantidad <= 0) {
                carrito = carrito.filter(i => i.id !== id);
            } else {
                const producto = productos.find(p => p.id === id);
                if (nuevaCantidad > producto.stock) {
                    mostrarNotificacion('‚ùå Stock insuficiente', 'error');
                    return;
                }
                const item = carrito.find(i => i.id === id);
                item.cantidad = nuevaCantidad;
            }
            mostrarCarrito();
        };

        window.procesarVenta = function() {
            if (carrito.length === 0) {
                mostrarNotificacion('‚ùå Carrito vac√≠o', 'error');
                return;
            }

            const total = carrito.reduce((s, i) => s + (i.precio * i.cantidad), 0);
            
            // Actualizar stock
            carrito.forEach(item => {
                const producto = productos.find(p => p.id === item.id);
                producto.stock -= item.cantidad;
            });

            // Registrar venta
            const nuevaVenta = {
                id: Date.now(),
                fecha: new Date().toISOString(),
                usuario: usuarioId,
                items: [...carrito],
                total: total
            };
            
            ventas.push(nuevaVenta);
            
            // Guardar en Firebase o localStorage
            guardarDatos();

            carrito = [];
            mostrarCarrito();
            mostrarProductos();
            mostrarNotificacion(`‚úÖ Venta procesada: ‚Ç¨${total.toFixed(2)}`, 'success');
        };

        // Funciones del almac√©n
        window.mostrarFormulario = function() {
            document.getElementById('formulario-nuevo').classList.remove('hidden');
        };

        window.ocultarFormulario = function() {
            document.getElementById('formulario-nuevo').classList.add('hidden');
            document.getElementById('nuevo-nombre').value = '';
            document.getElementById('nuevo-precio').value = '';
            document.getElementById('nuevo-stock').value = '';
        };

        window.agregarProducto = function() {
            const nombre = document.getElementById('nuevo-nombre').value;
            const precio = parseFloat(document.getElementById('nuevo-precio').value);
            const stock = parseInt(document.getElementById('nuevo-stock').value);
            const categoria = document.getElementById('nuevo-categoria').value;

            if (!nombre || !precio || isNaN(stock)) {
                mostrarNotificacion('‚ùå Todos los campos son obligatorios', 'error');
                return;
            }

            const nuevoProducto = {
                id: Date.now(),
                nombre: nombre,
                precio: precio,
                stock: stock,
                categoria: categoria
            };

            productos.push(nuevoProducto);
            guardarDatos();
            
            ocultarFormulario();
            mostrarTablaProductos();
            actualizarSelectAjuste();
            mostrarNotificacion('‚úÖ Producto agregado correctamente', 'success');
        };

        window.mostrarAjuste = function() {
            document.getElementById('formulario-ajuste').classList.remove('hidden');
        };

        window.ocultarAjuste = function() {
            document.getElementById('formulario-ajuste').classList.add('hidden');
            document.getElementById('ajuste-producto').value = '';
            document.getElementById('ajuste-cantidad').value = '';
            document.getElementById('ajuste-motivo').value = '';
        };

        function actualizarSelectAjuste() {
            const select = document.getElementById('ajuste-producto');
            select.innerHTML = '<option value="">Seleccionar producto</option>' + 
                productos.map(p => `<option value="${p.id}">${p.nombre}</option>`).join('');
        }

        window.procesarAjuste = function() {
            const productoId = parseInt(document.getElementById('ajuste-producto').value);
            const tipo = document.getElementById('ajuste-tipo').value;
            const cantidad = parseInt(document.getElementById('ajuste-cantidad').value);
            const motivo = document.getElementById('ajuste-motivo').value;

            if (!productoId || !cantidad || !motivo) {
                mostrarNotificacion('‚ùå Todos los campos son obligatorios', 'error');
                return;
            }

            const producto = productos.find(p => p.id === productoId);
            const stockAnterior = producto.stock;
            
            if (tipo === 'perdida') {
                producto.stock = Math.max(0, producto.stock - cantidad);
            } else {
                producto.stock += cantidad;
            }

            const nuevoAjuste = {
                id: Date.now(),
                fecha: new Date().toISOString(),
                usuario: usuarioId,
                producto: producto.nombre,
                tipo: tipo,
                cantidad: cantidad,
                motivo: motivo,
                stockAnterior: stockAnterior,
                stockNuevo: producto.stock
            };

            ajustes.push(nuevoAjuste);
            guardarDatos();

            ocultarAjuste();
            mostrarTablaProductos();
            verificarStockBajo();
            mostrarNotificacion('‚úÖ Ajuste registrado correctamente', 'success');
        };

        function mostrarTablaProductos() {
            const tbody = document.getElementById('tabla-productos');
            
            if (productos.length === 0) {
                tbody.innerHTML = '<tr><td colspan="5" class="border px-4 py-2 text-center text-gray-500">No hay productos registrados</td></tr>';
                return;
            }

            tbody.innerHTML = productos.map(p => `
                <tr class="${p.stock < 10 ? 'bg-red-50' : ''}">
                    <td class="border px-4 py-2">
                        ${editandoId === p.id ? 
                            `<input id="edit-nombre" value="${p.nombre}" class="w-full px-2 py-1 border rounded">` :
                            `<span class="font-medium">${p.nombre}</span>`
                        }
                    </td>
                    <td class="border px-4 py-2">
                        ${editandoId === p.id ? 
                            `<input id="edit-precio" type="number" step="0.01" value="${p.precio}" class="w-full px-2 py-1 border rounded">` :
                            `<span class="font-bold text-green-600">‚Ç¨${p.precio.toFixed(2)}</span>`
                        }
                    </td>
                    <td class="border px-4 py-2">
                        ${editandoId === p.id ? 
                            `<input id="edit-stock" type="number" value="${p.stock}" class="w-full px-2 py-1 border rounded">` :
                            `<span class="${p.stock < 10 ? 'font-bold text-red-600' : ''}">${p.stock}</span>`
                        }
                    </td>
                    <td class="border px-4 py-2">
                        <span class="bg-gray-100 px-2 py-1 rounded text-xs">${getCategoriaIcon(p.categoria)} ${p.categoria}</span>
                    </td>
                    <td class="border px-4 py-2">
                        ${editandoId === p.id ? 
                            `<div class="flex gap-2">
                                <button onclick="guardarEdicion(${p.id})" class="bg-green-600 text-white px-3 py-1 rounded text-sm">üíæ</button>
                                <button onclick="cancelarEdicion()" class="bg-gray-500 text-white px-3 py-1 rounded text-sm">‚ùå</button>
                            </div>` :
                            `<div class="flex gap-2">
                                <button onclick="editarProducto(${p.id})" class="bg-blue-600 text-white px-3 py-1 rounded text-sm">‚úèÔ∏è</button>
                                <button onclick="eliminarProducto(${p.id})" class="bg-red-600 text-white px-3 py-1 rounded text-sm">üóëÔ∏è</button>
                            </div>`
                        }
                    </td>
                </tr>
            `).join('');
        }

        window.editarProducto = function(id) {
            editandoId = id;
            mostrarTablaProductos();
        };

        window.guardarEdicion = function(id) {
            const nombre = document.getElementById('edit-nombre').value;
            const precio = parseFloat(document.getElementById('edit-precio').value);
            const stock = parseInt(document.getElementById('edit-stock').value);

            if (!nombre || !precio || isNaN(stock) || stock < 0) {
                mostrarNotificacion('‚ùå Datos inv√°lidos', 'error');
                return;
            }

            const producto = productos.find(p => p.id === id);
            producto.nombre = nombre;
            producto.precio = precio;
            producto.stock = stock;

            guardarDatos();
            editandoId = null;
            mostrarTablaProductos();
            verificarStockBajo();
            mostrarNotificacion('‚úÖ Producto actualizado', 'success');
        };

        window.cancelarEdicion = function() {
            editandoId = null;
            mostrarTablaProductos();
        };

        window.eliminarProducto = function(id) {
            if (confirm('¬øEst√°s seguro de eliminar este producto?')) {
                productos = productos.filter(p => p.id !== id);
                guardarDatos();
                mostrarTablaProductos();
                actualizarSelectAjuste();
                mostrarNotificacion('‚úÖ Producto eliminado', 'success');
            }
        };

        function verificarStockBajo() {
            const productosStockBajo = productos.filter(p => p.stock < 10);
            const alerta = document.getElementById('alerta-stock');
            
            if (productosStockBajo.length > 0) {
                document.getElementById('productos-stock-bajo').innerHTML = 
                    productosStockBajo.map(p => `${p.nombre} (${p.stock})`).join(', ');
                alerta.classList.remove('hidden');
            } else {
                alerta.classList.add('hidden');
            }
        }

        // Funciones de estad√≠sticas
        function actualizarEstadisticas() {
            const totalVentas = ventas.reduce((sum, v) => sum + v.total, 0);
            const numVentas = ventas.length;
            const numProductos = productos.length;
            const productosStockBajo = productos.filter(p => p.stock < 10).length;
            const numAjustes = ajustes.length;

            document.getElementById('total-ventas').textContent = `‚Ç¨${totalVentas.toFixed(2)}`;
            document.getElementById('num-ventas').textContent = `${numVentas} transacciones`;
            document.getElementById('num-productos').textContent = numProductos;
            document.getElementById('productos-bajo-stock').textContent = `${productosStockBajo} stock bajo`;
            document.getElementById('num-ajustes').textContent = numAjustes;

            mostrarTablaVentas();
        }

        function mostrarTablaVentas() {
            const container = document.getElementById('tabla-ventas-container');
            
            if (ventas.length === 0) {
                container.innerHTML = '<p class="text-center text-gray-500 py-8">No hay ventas registradas</p>';
                return;
            }

            const ventasRecientes = ventas.slice(-10).reverse();
            
            container.innerHTML = `
                <div class="overflow-x-auto">
                    <table class="w-full border-collapse border">
                        <thead class="bg-gray-100">
                            <tr>
                                <th class="border px-4 py-2 text-left">Fecha</th>
                                <th class="border px-4 py-2 text-left">Usuario</th>
                                <th class="border px-4 py-2 text-left">Items</th>
                                <th class="border px-4 py-2 text-left">Total</th>
                            </tr>
                        </thead>
                        <tbody>
                            ${ventasRecientes.map(v => `
                                <tr>
                                    <td class="border px-4 py-2">${new Date(v.fecha).toLocaleString()}</td>
                                    <td class="border px-4 py-2">${v.usuario ? v.usuario.slice(-8) : 'N/A'}</td>
                                    <td class="border px-4 py-2">${v.items.length} productos</td>
                                    <td class="border px-4 py-2 font-bold text-green-600">‚Ç¨${v.total.toFixed(2)}</td>
                                </tr>
                            `).join('')}
                        </tbody>
                    </table>
                </div>
            `;
        }

        function mostrarHistorialAjustes() {
            const tbody = document.getElementById('tabla-ajustes');
            
            if (ajustes.length === 0) {
                tbody.innerHTML = '<tr><td colspan="6" class="border px-4 py-2 text-center text-gray-500">No hay ajustes registrados</td></tr>';
                return;
            }

            tbody.innerHTML = ajustes.slice(-20).reverse().map(a => `
                <tr>
                    <td class="border px-4 py-2">${new Date(a.fecha).toLocaleString()}</td>
                    <td class="border px-4 py-2">${a.usuario ? a.usuario.slice(-8) : 'N/A'}</td>
                    <td class="border px-4 py-2">${a.producto}</td>
                    <td class="border px-4 py-2">${a.tipo === 'perdida' ? 'üìâ P√©rdida' : 'üìà Entrada'}</td>
                    <td class="border px-4 py-2">${a.cantidad}</td>
                    <td class="border px-4 py-2">${a.motivo}</td>
                </tr>
            `).join('');
        }

        // Funciones de configuraci√≥n
        window.exportarDatos = function() {
            const datos = {
                productos: productos,
                ventas: ventas,
                ajustes: ajustes,
                fecha: new Date().toISOString(),
                version: "2.0"
            };
            
            const blob = new Blob([JSON.stringify(datos, null, 2)], { type: 'application/json' });
            const url = URL.createObjectURL(blob);
            const a = document.createElement('a');
            a.href = url;
            a.download = `tpv-backup-${new Date().toISOString().split('T')[0]}.json`;
            a.click();
            URL.revokeObjectURL(url);
            
            mostrarNotificacion('‚úÖ Backup exportado correctamente', 'success');
        };

        window.importarBackup = function(input) {
            const file = input.files[0];
            if (!file) return;

            const reader = new FileReader();
            reader.onload = function(e) {
                try {
                    const datos = JSON.parse(e.target.result);
                    
                    if (confirm('¬øEst√°s seguro? Esto sobrescribir√° todos los datos actuales.')) {
                        if (datos.productos) productos = datos.productos;
                        if (datos.ventas) ventas = datos.ventas;
                        if (datos.ajustes) ajustes = datos.ajustes;
                        
                    guardarDatos();
                    mostrarTablaProductos();
                    actualizarSelectAjuste();
                    actualizarEstadisticas();
                    mostrarNotificacion('‚úÖ Backup importado correctamente', 'success');
                    }
                } catch (error) {
                    mostrarNotificacion('‚ùå Error al importar backup: archivo inv√°lido', 'error');
                }
            };
            reader.readAsText(file);
        };

        window.borrarVentas = function() {
            if (confirm('¬øEst√°s seguro de borrar todas las ventas?')) {
                ventas = [];
                guardarDatos();
                actualizarEstadisticas();
                mostrarNotificacion('‚úÖ Ventas borradas', 'success');
            }
        };

        window.resetCompleto = function() {
            if (confirm('¬øEST√ÅS SEGURO? Esto borrar√° TODOS los datos (productos, ventas, ajustes)')) {
                if (confirm('CONFIRMACI√ìN FINAL: Se perder√°n todos los datos')) {
                    productos = [];
                    ventas = [];
                    ajustes = [];
                    carrito = [];
                    
                    if (database) {
                        // Limpiar Firebase
                        set(ref(database, 'productos'), []);
                        set(ref(database, 'ventas'), []);
                        set(ref(database, 'ajustes'), []);
                    } else {
                        // Modo desarrollo - datos solo en memoria durante la sesi√≥n
                        console.log('Datos limpiados en memoria');
                    }
                    
                    mostrarTab('tpv');
                    mostrarNotificacion('‚úÖ Reset completo realizado', 'success');
                }
            }
        };

        window.sincronizarDatos = function() {
            if (database && isConnected) {
                mostrarNotificacion('üîÑ Sincronizando...', 'info');
                cargarDatosIniciales();
                setTimeout(() => {
                    mostrarNotificacion('‚úÖ Datos sincronizados', 'success');
                }, 1000);
            } else {
                mostrarNotificacion('‚ùå No conectado a Firebase', 'error');
            }
        };

        // Inicializar aplicaci√≥n
        document.addEventListener('DOMContentLoaded', function() {
            // Intentar conectar a Firebase autom√°ticamente si est√° configurado
            if (firebaseConfig.apiKey !== "TU_API_KEY") {
                inicializarBaseDatos();
            } else {
                // Usar datos en memoria si no est√° configurado Firebase
                cargarDatosLocales();
                actualizarEstadoConexion(false);
                mostrarNotificacion('‚ö†Ô∏è Firebase no configurado - usando modo desarrollo', 'info');
            }
            
            mostrarTab('tpv');
        });

        // Hacer funciones globales
        window.inicializarBaseDatos = inicializarBaseDatos;
    </script>
</body>
</html>